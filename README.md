# 小型支付商城系统  

本项目是一个基于 Spring Boot 实现的轻量级在线虚拟商品商城支付系统，聚焦支付流程的核心业务逻辑。项目借鉴真实生产场景，涵盖微信扫码登录、支付宝支付集成、订单处理、消息推送等模块。

> 仓库地址：[GitHub - xuefeng16513/s-pay-mall](https://github.com/xuefeng16513/s-pay-mall)

---

##  项目简介

本系统完整实现了在线商城中支付相关的完整业务流程。从用户登录鉴权、商品下单、支付接口打通、支付回调处理，到消息通知与异常补偿的一整套流程。

---

##  核心功能模块

| 功能模块     | 描述                                     |
|----------|----------------------------------------|
| 微信扫码登录   | 使用微信公众号接口实现扫码登录并获取用户基本信息               |
| 支付宝支付集成  | 使用支付宝沙箱环境完成支付流程，含下单、签名、回调处理            |
| 微信模板消息通知 | 支付完成后通过微信公众号发送模板通知                     |
| 商品下单     | 实现基础的商品下单判断逻辑                          |
| 订单管理     | 完整的订单状态生命周期管理（创建、支付中、支付成功/失败）， 使用 Redis 临时缓存未支付订单，仅在支付成功后写入数据库，提升系统性能与稳定性         |
| 内网穿透     | 使用 Natapp 实现本地开发接口暴露，便于测试微信/支付宝等外部系统回调 |

---

##  技术栈

- **后端框架**：Spring Boot
- **ORM 框架**：MyBatis
- **数据库**：MySQL, Redis
- **消息通知**：微信公众号模板消息接口
- **支付接口**：支付宝沙箱支付 / 微信扫码支付
- **系统部署**：NATAPP
- **项目管理**：Maven、Git

---

##  环境要求

| 环境组件 | 版本要求    |
|----------|-------------|
| JDK      | 1.8         |
| Maven    | 3.8+        |
| MySQL    | 5.7 或以上  |

---

## 快速启动

### 1. 克隆项目

```bash
git clone https://github.com/xuefeng16513/s-pay-mall.git
cd s-pay-mall
```

### 2. 配置数据库

请在 `application.yml` 中修改以下配置：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/pay_mall?useSSL=false
    username: root
    password: your_password
  redis:
    host: localhost
    port: 6379
    timeout: 5000
```

### 3. 导入SQL脚本

初始化数据库，脚本位置：

```
/doc/sql/pay_mall_init.sql
```

### 4. 启动项目

```bash
mvn spring-boot:run
```

或

```bash
java -jar target/s-pay-mall.jar
```

---

## 测试指南

### 微信扫码登录：

1. 注册微信公众号测试号
2. 配置接口地址（使用 NATAPP 暴露本地接口）
3. 扫描二维码并完成鉴权

### 支付测试：

- 支付宝：
  - 使用支付宝沙箱账号进行下单支付
  - 验证支付状态回调是否成功处理

- 微信模板通知：
  - 支付成功后通过公众号向用户发送模板消息